## icube lrwan directory structure
```
icube lrwan/
├── Applications/
|   ├── Core/ : application level codes of STM32
│   │   └── 
│   ├── LoRaWAN/ : application level codes of LoRaWAN
│   │   ├── App/
│   │   ├── Target/
│   │   │   ├── sx1276mb1mas_conf.h : pin mapping of this shield
│   │   │   └── radio_board_if.h : define which lora hat board's header file to include and its initialization.
│   └── SW4STM32/
|
├── Middlewares/
│   ├── LoRaWAN/
|   |   ├── Conf/
|   |   ├── Crypto/
|   |   ├── LmHandler/
|   |   ├── Mac/
|   |   |   ├── Region/
|   |   |   ├── LoRaMac.c
|   |   |   ├── LoRaMac.h
|   |   |   ├── LoRaMacAdr.c
|   |   |   ├── LoRaMacAdr.h
|   |   |   ├──
|   |   |   ├──
|   |   |   ├──
│   │   └── Utilities/
│   ├── mbedTLS/
│   │   └── ---
│   ├── SubGHZ_Phy/
│   │   ├── sx126x/ : folder containing codes for controlling sx126x radios (latest radio family by Semtech)
│   │   │   ├── radio.c : main wrapper file that implements APIs for controlling sx126x transceiver (RadioInit, RadioSetTxConfig, RadioSend, RadioRx etc).
│   │   │   ├── subghz_phy_version.h
│   │   |   ├── sx126x.h
│   │   │   └── sx126x.c
│   │   ├── sx1272/ : folder containing codes for controlling sx1272 radios.
│   │   │   ├── subghz_phy_version.h
│   │   │   ├── sx1272.c : main wrapper file that implements APIs for controlling sx1272 transceiver (RadioInit, RadioSetTxConfig, RadioSend, RadioRx etc).
│   │   │   ├── sx1272.h
│   │   │   ├── sx1272Regs-Fsk.h
│   │   │   └── sx1272Regs-LoRa.h
│   │   ├── sx1276/ : folder containing codes for controlling sx1276 radios.
│   │   │   ├── subghz_phy_version.h
│   │   │   ├── sx1276.c : main wrapper file that implements APIs for controlling sx1276 transceiver (RadioInit, RadioSetTxConfig, RadioSend, RadioRx etc).
│   │   │   ├── sx1276.h
│   │   │   ├── sx1276Regs-Fsk.h
│   │   │   └── sx1276Regs-LoRa.h
│   │   └── radio.h : main header file for application-level code (it’s only the interface). It is internally mapped to LoRa radio’s main API files (sx1272.c, sx1276.c, sx126x etc).
|
├── Drivers/
|   ├── BSP/
|   |   ├── B-L072Z-LRWAN1/ : bsp for B-L072Z-LRWAN1 board
|   |   ├── CMWX1ZZABZ_0xx/ : bsp for CMWX1ZZABZ_0xx series of LoRaWAN modules manufactured by Murata Electronics
|   |   ├── components/
|   |   |         ├── common : don`t know exactly (https://github.com/STMicroelectronics/stm32-bsp-common)
|   |   |         ├── hts221 : header files for the HTS221 humidity-temperature sensor (https://github.com/STMicroelectronics/stm32-hts221)
|   |   |         ├── lis2dw12 : header files for the LIS2DW12 accelerometer sensor
|   |   |         ├── lis2mdl : header files for the LIS2MDL magnetic sensor
|   |   |         ├── lps22hb : header files for the lps22hb pressure sensor
|   |   |         ├── lps22hh : header files for the lps22hh pressure sensor
|   |   |         ├── lps25hb : header files for the lps25hb pressure sensor
|   |   |         ├── lsm6dsl : header files for the lsm6dsl imu
|   |   |         ├── lsm6dso : header files for the lsm6dso imu
|   |   |         ├── lsm303agr : header files for the lsm303agr imu
|   |   |         └── stts751 : header files for the stts751 temperature sensor
|   |   ├── IKS01A2/ : bsp for X-NUCLEO-IKS01A2 motion MEMS and environmental sensor expansion board
|   |   ├── IKS01A3/ : bsp for X-NUCLEO-IKS01A3 motion MEMS and environmental sensor expansion board
|   |   ├── I_NUCLEO_LRWAN1/ : bsp for I-NUCLEO-LRWAN1 board
|   |   ├── LRWAN_NS1/ : bsp for LRWAN_NS1 ARDUINO® compatible expansion board
|   |   ├── MDM32L07X01/ : ?
|   |   ├── MDM32WL/ : ?
|   |   ├── STM32L0xx_Nucleo/ : bsp for STM32L0xx_Nucleo 
|   |   ├── STM32L1xx_Nucleo/ : bsp for STM32L1xx_Nucleo 
|   |   ├── STM32L4xx_Nucleo/ : bsp for STM32L4xx_Nucleo 
|   |   ├── sx1276mb1las/ : bsp for Semtech lora expansion board
|   |   ├── sx1272mb2das/ : bsp for Semtech lora expansion board
|   |   ├── sx1276mb1mas/ : bsp for Semtech lora expansion board
|   |   ├── SX1261DVK1BAS/ : bsp for Semtech lora expansion board
|   |   ├── SX1262DVK1CAS/ : bsp for Semtech lora expansion board
|   |   └── SX1262DVK1DAS/ : bsp for Semtech lora expansion board
|   ├── CMSIS/
|   ├── STM32L0xx_HAL_Driver/
|   ├── STM32L1xx_HAL_Driver/
|   ├── STM32L4xx_HAL_Driver/
|   |   ├── 

```

### note
- seems like `radio.c` in `middleware/subGHz_phy` is main file that controll all radio operations
  - but it is generated by stmcubide based on project configuration. cant see in the library
  - seems like the file is generated from the general fiel /Middlewares/Third_Party/SubGHz_Phy/sx126x/radio.c, thisfile contain the Skeleton / interface declaration (probably the original Semtech reference driver).
  - provides a generic API (RadioInit, RadioSetTxConfig, RadioSend, RadioRx) for controlling radio
  - act as a gayway between and top level application and low-level chip driver.

# Configuration
## choose frequency channel
- go to LoRaWAN/APP/lora_app.h and edit the following macros
```
/* LoraWAN application configuration (Mw is configured by lorawan_conf.h) */
#define ACTIVE_REGION                               LORAMAC_REGION_IN865
```
- you can see the implementation of ACTIVE_REGION as enum definition in `middlewares/LoRaWAN/Mac/LoRaMac.h` and the values are used inside `LoRaWAN/APP/lora_app.c`

## Select Activation type
- go to -> LoRaWAN/APP/lora_app.h and edit the following macros
```
#define LORAWAN_DEFAULT_ACTIVATION_TYPE   -> ACTIVATION_TYPE_OTAA/ACTIVATION_TYPE_ABP
```
- if you dont want to hardcode it, Add the following flag to your compiler options
```
-DLORAWAN_DEFAULT_ACTIVATION_TYPE=ACTIVATION_TYPE_ABP
```
- you can see the implementation of ACTIVATION_TYPE as enum definition in `middlewares/LoRaWAN/Mac/LoRaMac.h` and the values are used inside `LoRaWAN/APP/lora_app.c`
  - static ActivationType_t ActivationType = LORAWAN_DEFAULT_ACTIVATION_TYPE;

## Add activation keys
- **Note**: secure-element implementation supports both 1.0.x and 1.1.x LoRaWAN versions. read the doc in app/App/se-identity.h to see the changes in keys
### ABP
- Obtain the Device address, Network session key, and Application session key from Chirpstack server
- Navigate to applications -> LoRaWAN -> App -> se-identity.h and change the following macros
```
#define STATIC_DEVICE_ADDRESS    -> 1
#define LORAWAN_DEVICE_ADDRESS   -> Device address from chirpstack
#define LORAWAN_NWK_KEY          -> Network root key from Chirpstack (For LoRaWAN version 1.0.x use same key for Network root key and Network session key)
#define LORAWAN_APP_S_KEY        -> Application session key from Chirpstack
#define LORAWAN_NWK_S_KEY        -> Network session key from Chirpstack
```
### OTA
- Obtain the device EUI, join EUI, and application key from Chirpstack server
- Navigate to applications -> LoRaWAN -> App -> se-identity.h and change the following macros
```
#define STATIC_DEVICE_EUI       -> 1
#define LORAWAN_DEVICE_EUI      -> Device EUI from Chirpstack
#define LORAWAN_JOIN_EUI        -> Join EUI from Chirpstack
#define LORAWAN_APP_KEY         -> Application root key from Chirpstack
```
